# Vercel.json é…ç½®è¯¦è§£ ğŸ“–

## ğŸ“‹ é…ç½®æ–‡ä»¶è¯´æ˜

æ­¤æ–‡æ¡£è¯¦ç»†è§£é‡Š `vercel.json` ä¸­å„ä¸ªé…ç½®é¡¹çš„ä½œç”¨å’Œç”¨æ³•ã€‚

## ğŸ”§ åŸºç¡€é…ç½®

```json
{
  "buildCommand": "pnpm build",        // æ„å»ºå‘½ä»¤ï¼šä½¿ç”¨ pnpm åŒ…ç®¡ç†å™¨æ„å»ºé¡¹ç›®
  "installCommand": "pnpm install",    // å®‰è£…å‘½ä»¤ï¼šå®‰è£…ä¾èµ–åŒ…
  "framework": "nextjs",               // æ¡†æ¶ç±»å‹ï¼šNext.js åº”ç”¨
  "regions": ["iad1", "cle1", "pdx1"]  // éƒ¨ç½²åœ°åŒºï¼šç¾å›½ä¸œéƒ¨ã€ä¸­éƒ¨ã€è¥¿éƒ¨
}
```

### ğŸŒ Regionsï¼ˆéƒ¨ç½²åœ°åŒºï¼‰è¯´æ˜

| åœ°åŒºä»£ç  | ä½ç½® | è¯´æ˜ |
|---------|------|------|
| `iad1` | ç¾å›½ä¸œéƒ¨ (å¼—å‰å°¼äºš) | ä¸»è¦æœåŠ¡åŒ—ç¾ä¸œæµ·å²¸ç”¨æˆ· |
| `cle1` | ç¾å›½ä¸­éƒ¨ (ä¿„äº¥ä¿„) | æœåŠ¡ç¾å›½ä¸­éƒ¨åœ°åŒº |
| `pdx1` | ç¾å›½è¥¿éƒ¨ (ä¿„å‹’å†ˆ) | æœåŠ¡åŒ—ç¾è¥¿æµ·å²¸ç”¨æˆ· |

**ä¸ºä»€ä¹ˆé€‰æ‹©ç¾å›½åœ°åŒºï¼Ÿ**
- ğŸ¯ ä¸»è¦ç”¨æˆ·ç¾¤ä½“åœ¨åŒ—ç¾
- ğŸš€ æ›´å¥½çš„æœåŠ¡å™¨æ€§èƒ½å’Œç¨³å®šæ€§
- ğŸ’° æ›´ç»æµçš„æˆæœ¬ç»“æ„

## âš¡ Functionsï¼ˆæ— æœåŠ¡å™¨å‡½æ•°ï¼‰é…ç½®

```json
{
  "functions": {
    "app/api/**": {
      "maxDuration": 30        // æ™®é€š API è·¯ç”±æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼š30ç§’
    },
    "app/api/video-to-recipes/**": {
      "maxDuration": 120       // è§†é¢‘å¤„ç† API æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼š120ç§’
    }
  }
}
```

**è¯´æ˜ï¼š**
- è§†é¢‘å¤„ç†éœ€è¦æ›´é•¿æ—¶é—´ï¼Œè®¾ç½®ä¸º 120 ç§’
- å…¶ä»– API è·¯ç”±è®¾ç½®ä¸º 30 ç§’ï¼Œé˜²æ­¢è¶…æ—¶

## ğŸ”’ Headersï¼ˆHTTP å¤´éƒ¨ï¼‰é…ç½®

```json
{
  "headers": [
    {
      "source": "/(.*)",      // åŒ¹é…æ‰€æœ‰è·¯å¾„
      "headers": [
        {
          "key": "X-Frame-Options",
          "value": "SAMEORIGIN"                    // é˜²æ­¢ç‚¹å‡»åŠ«æŒæ”»å‡»
        },
        {
          "key": "X-Content-Type-Options", 
          "value": "nosniff"                       // é˜²æ­¢ MIME ç±»å‹å—…æ¢
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"                 // å¯ç”¨ XSS ä¿æŠ¤
        },
        {
          "key": "Referrer-Policy",
          "value": "origin-when-cross-origin"      // è·¨åŸŸæ—¶åªå‘é€æºç«™ä¿¡æ¯
        }
      ]
    },
    {
      "source": "/_next/static/(.*)",            // åŒ¹é… Next.js é™æ€èµ„æº
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"  // é™æ€èµ„æºé•¿æœŸç¼“å­˜
        }
      ]
    }
  ]
}
```

## ğŸ”„ Redirectsï¼ˆé‡å®šå‘ï¼‰è¯¦è§£

```json
{
  "redirects": [
    {
      "source": "/www.brickrecipes.ai/(.*)",     // æºè·¯å¾„ï¼šåŒ¹é… www å­åŸŸå
      "destination": "https://brickrecipes.ai/$1", // ç›®æ ‡è·¯å¾„ï¼šé‡å®šå‘åˆ°ä¸»åŸŸå
      "permanent": true                          // æ°¸ä¹…é‡å®šå‘ (301)
    }
  ]
}
```

### â“ ä»€ä¹ˆæ˜¯ Redirectsï¼Ÿ

**Redirects** æ˜¯ **HTTP é‡å®šå‘**ï¼Œæµè§ˆå™¨ä¼šæ”¶åˆ°é‡å®šå‘çŠ¶æ€ç ï¼Œå¹¶è‡ªåŠ¨è·³è½¬åˆ°æ–° URLã€‚

**ç‰¹ç‚¹ï¼š**
- ğŸ”„ æµè§ˆå™¨åœ°å€æ ä¼šæ”¹å˜
- ğŸ“Š æœç´¢å¼•æ“ä¼šæ›´æ–°ç´¢å¼•
- âš¡ æœ‰è½»å¾®çš„æ€§èƒ½å¼€é”€ï¼ˆé¢å¤–çš„ HTTP è¯·æ±‚ï¼‰

**ä½¿ç”¨åœºæ™¯ï¼š**
- åŸŸåç»Ÿä¸€ï¼ˆwww â†’ ä¸»åŸŸåï¼‰
- æ—§é¡µé¢è¿ç§»åˆ°æ–° URL
- å¼ºåˆ¶ HTTPS è·³è½¬

**ç¤ºä¾‹æ•ˆæœï¼š**
```
ç”¨æˆ·è®¿é—®ï¼šhttps://www.brickrecipes.ai/menu
â†“
æµè§ˆå™¨æ¥æ”¶ï¼š301 Moved Permanently
â†“  
è‡ªåŠ¨è·³è½¬ï¼šhttps://brickrecipes.ai/menu
æµè§ˆå™¨åœ°å€æ æ˜¾ç¤ºï¼šhttps://brickrecipes.ai/menu
```

## ğŸ”€ Rewritesï¼ˆé‡å†™ï¼‰è¯¦è§£

```json
{
  "rewrites": [
    {
      "source": "/sitemap.xml",          // ç”¨æˆ·è¯·æ±‚çš„è·¯å¾„
      "destination": "/api/sitemap"      // å®é™…å¤„ç†çš„è·¯å¾„
    }
  ]
}
```

### â“ ä»€ä¹ˆæ˜¯ Rewritesï¼Ÿ

**Rewrites** æ˜¯ **å†…éƒ¨è·¯å¾„é‡å†™**ï¼ŒæœåŠ¡å™¨åœ¨å†…éƒ¨å¤„ç†è¯·æ±‚ï¼Œç”¨æˆ·çœ‹ä¸åˆ°çœŸå®è·¯å¾„ã€‚

**ç‰¹ç‚¹ï¼š**
- ğŸ”’ æµè§ˆå™¨åœ°å€æ ä¸ä¼šæ”¹å˜
- ğŸ­ å¯¹ç”¨æˆ·å®Œå…¨é€æ˜
- âš¡ æ²¡æœ‰é¢å¤–çš„ HTTP è¯·æ±‚
- ğŸ”§ çº¯æœåŠ¡å™¨ç«¯æ“ä½œ

**ä½¿ç”¨åœºæ™¯ï¼š**
- API è·¯å¾„ç¾åŒ–
- åŠ¨æ€ç”Ÿæˆé™æ€æ–‡ä»¶ï¼ˆå¦‚ sitemapï¼‰
- ä»£ç†åˆ°ä¸åŒçš„æœåŠ¡
- A/B æµ‹è¯•è·¯ç”±

**ç¤ºä¾‹æ•ˆæœï¼š**
```
ç”¨æˆ·è®¿é—®ï¼šhttps://brickrecipes.ai/sitemap.xml
â†“
æœåŠ¡å™¨å†…éƒ¨å¤„ç†ï¼š/api/sitemap è·¯ç”±
â†“
è¿”å›ï¼šåŠ¨æ€ç”Ÿæˆçš„ XML å†…å®¹
æµè§ˆå™¨åœ°å€æ æ˜¾ç¤ºï¼šhttps://brickrecipes.ai/sitemap.xml (ä¸å˜)
```

## ğŸ“Š Redirects vs Rewrites å¯¹æ¯”

| ç‰¹æ€§ | Redirects (é‡å®šå‘) | Rewrites (é‡å†™) |
|------|-------------------|----------------|
| **æµè§ˆå™¨åœ°å€æ ** | âœ… ä¼šæ”¹å˜ | âŒ ä¸ä¼šæ”¹å˜ |
| **HTTP çŠ¶æ€ç ** | 301/302 | 200 |
| **æ€§èƒ½å¼€é”€** | ğŸ”´ æœ‰ï¼ˆé¢å¤–è¯·æ±‚ï¼‰ | ğŸŸ¢ æ—  |
| **SEO å½±å“** | âœ… æ›´æ–°ç´¢å¼• | âŒ ä¿æŒåŸè·¯å¾„ |
| **ç”¨æˆ·æ„ŸçŸ¥** | âœ… å¯è§è·³è½¬ | âŒ å®Œå…¨é€æ˜ |
| **ä½¿ç”¨åœºæ™¯** | åŸŸåç»Ÿä¸€ã€é¡µé¢è¿ç§» | API ç¾åŒ–ã€ä»£ç† |

## ğŸ’¡ æœ€ä½³å®è·µ

### ğŸ”„ ä½•æ—¶ä½¿ç”¨ Redirects

```json
// âœ… å¥½çš„ç”¨ä¾‹
{
  "source": "/old-page",
  "destination": "/new-page",
  "permanent": true
}

// âœ… åŸŸåç»Ÿä¸€
{
  "source": "/www.example.com/(.*)",
  "destination": "https://example.com/$1", 
  "permanent": true
}

// âœ… å¼ºåˆ¶ HTTPS
{
  "source": "http://example.com/(.*)",
  "destination": "https://example.com/$1",
  "permanent": true
}
```

### ğŸ”€ ä½•æ—¶ä½¿ç”¨ Rewrites

```json
// âœ… å¥½çš„ç”¨ä¾‹
{
  "source": "/sitemap.xml",
  "destination": "/api/sitemap"
}

// âœ… API ç¾åŒ–
{
  "source": "/blog/:slug",
  "destination": "/api/blog/:slug"
}

// âœ… ä»£ç†åˆ°å¤–éƒ¨æœåŠ¡
{
  "source": "/proxy/:path*",
  "destination": "https://external-api.com/:path*"
}
```

## ğŸ¯ å½“å‰é…ç½®è§£é‡Š

æˆ‘ä»¬çš„ `vercel.json` é…ç½®ï¼š

1. **Redirect `www` â†’ ä¸»åŸŸå**
   ```json
   {
     "source": "/www.brickrecipes.ai/(.*)",
     "destination": "https://brickrecipes.ai/$1",
     "permanent": true
   }
   ```
   - ç¡®ä¿æ‰€æœ‰è®¿é—®éƒ½ç»Ÿä¸€åˆ°ä¸»åŸŸå
   - æœ‰åˆ©äº SEO å’Œå“ç‰Œä¸€è‡´æ€§

2. **Rewrite sitemap è¯·æ±‚**
   ```json
   {
     "source": "/sitemap.xml", 
     "destination": "/api/sitemap"
   }
   ```
   - ç”¨æˆ·è®¿é—® `/sitemap.xml` æ—¶ï¼Œå†…éƒ¨è°ƒç”¨ API åŠ¨æ€ç”Ÿæˆ
   - ä¿æŒæ ‡å‡†çš„ SEO URL æ ¼å¼

## ğŸš€ éƒ¨ç½²åéªŒè¯

```bash
# æµ‹è¯•é‡å®šå‘
curl -I https://www.brickrecipes.ai
# åº”è¯¥è¿”å›ï¼šLocation: https://brickrecipes.ai

# æµ‹è¯•é‡å†™  
curl https://brickrecipes.ai/sitemap.xml
# åº”è¯¥è¿”å›ï¼šåŠ¨æ€ç”Ÿæˆçš„ XML å†…å®¹ï¼Œåœ°å€æ ä¿æŒ /sitemap.xml
```

---

ğŸ’¡ **æç¤º**ï¼šç”±äº JSON ä¸æ”¯æŒæ³¨é‡Šï¼Œæˆ‘ä»¬å°†æ­¤è¯´æ˜æ–‡æ¡£å•ç‹¬ç»´æŠ¤ã€‚åœ¨ä¿®æ”¹ `vercel.json` æ—¶ï¼Œè¯·åŒæ—¶æ›´æ–°æ­¤æ–‡æ¡£ï¼ 